<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0F172A">
  <title>Agro Berry â€” Phytosanitaire</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒ¿</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent;margin:0;padding:0}
    body{font-family:'Plus Jakarta Sans',system-ui,sans-serif;background:#F1F5F9;overscroll-behavior:none;color:#1E293B}
    body.dark{background:#0F172A;color:#E2E8F0}
    ::-webkit-scrollbar{width:3px;height:3px}
    ::-webkit-scrollbar-thumb{background:#94A3B8;border-radius:4px}
    @keyframes slideDown{from{opacity:0;transform:translate(-50%,-20px)}to{opacity:1;transform:translate(-50%,0)}}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    @keyframes slideUp{from{opacity:0;transform:translateY(100%)}to{opacity:1;transform:translateY(0)}}
    @keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}
    @keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(239,68,68,0.4)}70%{box-shadow:0 0 0 8px rgba(239,68,68,0)}}
    .blink{animation:blink 1.2s ease-in-out infinite}
    .pulse{animation:pulse 2s infinite}
    input,select,textarea,button{font-family:inherit}
    .glass{background:rgba(255,255,255,0.85);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px)}
    .dark .glass{background:rgba(15,23,42,0.85)}
    .btn{padding:10px 16px;border-radius:12px;border:none;font-weight:600;font-size:13px;cursor:pointer;transition:all 0.2s;display:inline-flex;align-items:center;gap:6px}
    .btn:active{transform:scale(0.97)}
    .btn-primary{background:linear-gradient(135deg,#10B981,#059669);color:#fff;box-shadow:0 2px 8px rgba(16,185,129,0.3)}
    .btn-surv{background:linear-gradient(135deg,#F59E0B,#D97706);color:#fff;box-shadow:0 2px 8px rgba(245,158,11,0.3)}
    .btn-trt{background:linear-gradient(135deg,#8B5CF6,#7C3AED);color:#fff;box-shadow:0 2px 8px rgba(139,92,246,0.3)}
    .btn-danger{background:linear-gradient(135deg,#EF4444,#DC2626);color:#fff;box-shadow:0 2px 8px rgba(239,68,68,0.3)}
    .btn-ghost{background:transparent;border:1.5px solid #E2E8F0;color:#64748B}
    .dark .btn-ghost{border-color:#334155;color:#94A3B8}
    .card{border-radius:16px;overflow:hidden;transition:all 0.2s}
    .photo-grid{display:flex;gap:4px;flex-wrap:wrap;margin-top:6px}
    .photo-grid img{width:56px;height:56px;object-fit:cover;border-radius:10px;cursor:pointer;border:2px solid rgba(0,0,0,0.06)}
    .photo-full{position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0.92);display:flex;align-items:center;justify-content:center;cursor:pointer}
    .photo-full img{max-width:95%;max-height:90vh;border-radius:12px}
    .tag{padding:3px 10px;border-radius:20px;font-size:10px;font-weight:700;display:inline-flex;align-items:center;gap:3px}
    .del-btn{background:none;border:none;font-size:13px;cursor:pointer;padding:2px 4px;opacity:0.6}
    .del-btn:hover{opacity:1}
  </style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel">
const {useState,useEffect,useRef} = React;
const VER = "3.0.0";

const SECTIONS = {
  AG1:{name:"AG1",label:"HLS",fullName:"Myrtille Hors Sol",area:"3.00 ha",date:"Sept 2025",type:"hls",color:"#3B82F6",parcelles:[{id:"V13",area:"0.66 ha"},{id:"V14",area:"0.74 ha"},{id:"V15",area:"0.68 ha"},{id:"V16",area:"0.86 ha"},{id:"V9",area:"0.63 ha"},{id:"V6",area:"0.74 ha"}]},
  AG2:{name:"AG2",label:"HLS",fullName:"Myrtille Hors Sol",area:"2.60 ha",date:"Oct 2025",type:"hls",color:"#6366F1",parcelles:[{id:"V17",area:"0.91 ha"},{id:"V18",area:"1.00 ha"},{id:"V19",area:"0.70 ha"}]},
  AG3a:{name:"AG3",label:"HLS",fullName:"Myrtille HLS (2024)",area:"1.80 ha",date:"Juil 2024",type:"hls",color:"#8B5CF6",parcelles:[{id:"V3",area:"0.30 ha"},{id:"V5",area:"0.21 ha"},{id:"V6",area:"0.39 ha"},{id:"V12",area:"0.21 ha"},{id:"V8",area:"0.20 ha"},{id:"V9",area:"0.30 ha"}]},
  AG3b:{name:"AG3",label:"HLS",fullName:"Myrtille HLS (2023)",area:"2.00 ha",date:"Jan 2023",type:"hls",color:"#7C3AED",parcelles:[{id:"V10",area:"0.36 ha"},{id:"V11",area:"0.25 ha"},{id:"V16",area:"0.88 ha"},{id:"V17",area:"0.79 ha"}]},
  AG4:{name:"AG4",label:"S",fullName:"Myrtille Sol",area:"6.00 ha",date:"Jan 2023",type:"sol",color:"#DC2626",parcelles:[{id:"V1",area:"0.42 ha"},{id:"V2",area:"0.31 ha"},{id:"V4",area:"0.42 ha"},{id:"V5",area:"0.21 ha"},{id:"V7",area:"0.45 ha"},{id:"V12",area:"0.45 ha"},{id:"V13",area:"0.45 ha"},{id:"V15",area:"0.55 ha"},{id:"V19",area:"0.78 ha"},{id:"V20",area:"0.66 ha"},{id:"V21",area:"0.65 ha"},{id:"V18",area:"0.79 ha"}]},
  AG5:{name:"AG5",label:"S",fullName:"Myrtille Sol",area:"2.70 ha",date:"Oct 2011",type:"sol",color:"#E11D48",parcelles:[{id:"V5",area:"0.70 ha"},{id:"V6",area:"0.74 ha"},{id:"V9",area:"0.63 ha"},{id:"V10",area:"0.54 ha"},{id:"V11",area:"0.66 ha"}]},
  AG6:{name:"AG6",label:"S",fullName:"Myrtille Sol",area:"4.00 ha",date:"Avr 2013",type:"sol",color:"#EA580C",parcelles:[{id:"V31",area:"0.83 ha"},{id:"V32",area:"0.66 ha"},{id:"V33",area:"0.59 ha"},{id:"V34",area:"0.64 ha"},{id:"V35",area:"0.73 ha"},{id:"V36",area:"0.52 ha"}]},
  S1:{name:"S1",label:"F",fullName:"Fraise",area:"5.50 ha",date:"Oct 2025",type:"fraise",color:"#16A34A",parcelles:[{id:"V1",area:"0.68 ha"},{id:"V2",area:"0.37 ha"},{id:"V3",area:"0.72 ha"},{id:"V4",area:"0.80 ha"},{id:"V5",area:"0.75 ha"},{id:"V6",area:"0.29 ha"},{id:"V7",area:"0.87 ha"},{id:"V8",area:"0.76 ha"},{id:"V9",area:"0.26 ha"}]},
  S2:{name:"S2",label:"F",fullName:"Fraise",area:"6.60 ha",date:"Oct 2025",type:"fraise",color:"#059669",parcelles:[{id:"V10",area:"0.77 ha"},{id:"V11",area:"0.85 ha"},{id:"V12",area:"0.66 ha"},{id:"V13",area:"1.52 ha"},{id:"V14",area:"0.67 ha"},{id:"V15",area:"1.50 ha"},{id:"V16",area:"0.66 ha"},{id:"V17",area:"1.50 ha"},{id:"V18",area:"0.60 ha"}]},
  S3:{name:"S3",label:"F",fullName:"Fraise",area:"3.80 ha",date:"Oct 2025",type:"fraise",color:"#0D9488",parcelles:[{id:"V19",area:"1.00 ha"},{id:"V20",area:"0.70 ha"}]}
};

const DIS_M=["Botrytis (Pourriture grise)","OÃ¯dium","Phytophthora","Anthracnose","Rouille","Moniliose","Septoriose","Alternaria","Acariens","Pucerons","Drosophila suzukii","Cochenilles","Thrips","NÃ©matodes","Chlorose ferrique","Carence magnÃ©sium"];
const DIS_F=["Botrytis (Pourriture grise)","OÃ¯dium","Phytophthora","Anthracnose","Verticilliose","Rhizoctone","Taches foliaires","Mildiou","Acariens","Pucerons","Thrips","Aleurodes","Limaces","NÃ©matodes","Chlorose ferrique","Carence calcium"];

const gid = () => Date.now().toString(36) + Math.random().toString(36).substr(2);
const fD = d => new Date(d).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});
const fH = d => new Date(d).toLocaleString("fr-FR",{hour:"2-digit",minute:"2-digit"});
const isToday = d => new Date().toDateString() === new Date(d).toDateString();
const isThisWeek = d => { const diff=(new Date()-new Date(d))/864e5; return diff>=0 && diff<7; };
const timeAgo = d => { const m=Math.floor((new Date()-new Date(d))/6e4); if(m<1) return "maintenant"; if(m<60) return m+"min"; const h=Math.floor(m/60); if(h<24) return h+"h"; return Math.floor(h/24)+"j"; };

const SC = {Faible:{bg:"#FEF9C3",text:"#854D0E",border:"#FDE047",icon:"ğŸŸ¡"},Moyen:{bg:"#FED7AA",text:"#9A3412",border:"#FB923C",icon:"ğŸŸ "},Grave:{bg:"#FECACA",text:"#991B1B",border:"#F87171",icon:"ğŸ”´"}};
const stClr = {clean:"#22C55E",faible:"#EAB308",moyen:"#F97316",grave:"#EF4444",resolved:"#94A3B8"};
const stBg = {clean:"#fff",faible:"#FFFBEB",moyen:"#FFF7ED",grave:"#FEF2F2",resolved:"#F8FAFC"};
const stBdr = {clean:"#E5E7EB",faible:"#FDE047",moyen:"#FB923C",grave:"#EF4444",resolved:"#CBD5E1"};

function ld(k,f){try{return JSON.parse(localStorage.getItem("ab_"+k))||f}catch(e){return f}}
function sv(k,d){try{localStorage.setItem("ab_"+k,JSON.stringify(d))}catch(e){if(k==="observations"){try{localStorage.setItem("ab_"+k,JSON.stringify(d.map(function(o){return Object.assign({},o,{photos:(o.photos||[]).slice(0,1)})})))}catch(e2){localStorage.setItem("ab_"+k,JSON.stringify(d.map(function(o){return Object.assign({},o,{photos:[]})})))}}}}

// Migration
(function(){var old=ld("records",[]);if(old.length>0&&ld("observations",null)===null){var obs=[],trt=[];old.forEach(function(r){var oid=gid();obs.push({id:oid,sk:r.sk,pid:r.pid,dis:r.dis,sev:r.sev,date:r.tdate||r.at,obsText:r.obs||"",zone:"",photos:[],res:r.res||false,resAt:r.resAt||null,by:"user",at:r.at});if(r.prod&&r.dose)trt.push({id:gid(),sk:r.sk,pid:r.pid,obsId:oid,prod:r.prod,dose:r.dose,tdate:r.tdate||r.at,dar:"",darEnd:"",notes:"",by:"user",at:r.at})});sv("observations",obs);sv("treatments",trt)}})();

async function ghSync(c,data){var ct=btoa(unescape(encodeURIComponent(JSON.stringify(data,null,2))));var u="https://api.github.com/repos/"+c.owner+"/"+c.repo+"/contents/data/phyto-data.json";var sha=null;try{var e=await fetch(u,{headers:{Authorization:"token "+c.token}});if(e.ok)sha=(await e.json()).sha}catch(err){}var b={message:"Sync phyto",content:ct};if(sha)b.sha=sha;return fetch(u,{method:"PUT",headers:{Authorization:"token "+c.token,"Content-Type":"application/json"},body:JSON.stringify(b)})}
async function ghRestore(c){var u="https://api.github.com/repos/"+c.owner+"/"+c.repo+"/contents/data/phyto-data.json";var r=await fetch(u,{headers:{Authorization:"token "+c.token}});if(r.ok){var f=await r.json();return JSON.parse(decodeURIComponent(escape(atob(f.content))))}return null}

function compressImg(file){return new Promise(function(res){var img=new Image();img.onload=function(){var c=document.createElement("canvas");var w=img.width,h=img.height;if(w>800){h=h*(800/w);w=800}c.width=w;c.height=h;c.getContext("2d").drawImage(img,0,0,w,h);res(c.toDataURL("image/jpeg",0.6))};img.src=URL.createObjectURL(file)})}

function PhotoViewer({src,onClose}){return <div className="photo-full" onClick={onClose}><img src={src} onClick={function(e){e.stopPropagation()}}/></div>}
function PhotoGrid({photos,dark}){var s=useState(null),v=s[0],setV=s[1];if(!photos||!photos.length)return null;return <><div className="photo-grid">{photos.map(function(p,i){return <img key={i} src={p} onClick={function(){setV(p)}}/>})}</div>{v&&<PhotoViewer src={v} onClose={function(){setV(null)}}/>}</>}
function PhotoCapture({photos,setPhotos,dark,bd}){
  var ref=useRef();
  function handleAdd(e){Array.from(e.target.files).forEach(function(f){compressImg(f).then(function(c){setPhotos(function(p){return p.concat([c])})})})}
  return <div>
    <div style={{display:"flex",gap:6,flexWrap:"wrap",marginBottom:6}}>
      {photos.map(function(p,i){return <div key={i} style={{position:"relative"}}>
        <img src={p} style={{width:56,height:56,objectFit:"cover",borderRadius:10,border:"2px solid "+(dark?"#334155":"#E2E8F0")}}/>
        <button onClick={function(){setPhotos(function(ps){return ps.filter(function(_,j){return j!==i})})}} style={{position:"absolute",top:-5,right:-5,width:20,height:20,borderRadius:"50%",background:"#EF4444",color:"#fff",border:"2px solid #fff",fontSize:10,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"}}>âœ•</button>
      </div>})}
    </div>
    <button onClick={function(){ref.current.click()}} className="btn btn-ghost" style={{width:"100%",justifyContent:"center"}}>{"ğŸ“· "+(photos.length?photos.length+" photo"+(photos.length>1?"s":""):"Ajouter photo")}</button>
    <input ref={ref} type="file" accept="image/*" capture="environment" multiple onChange={handleAdd} style={{display:"none"}}/>
  </div>
}

function App(){
  var s1=useState(function(){return ld("observations",[])}),observations=s1[0],setObs=s1[1];
  var s2=useState(function(){return ld("treatments",[])}),treatments=s2[0],setTrt=s2[1];
  var s3=useState("dash"),page=s3[0],setPage=s3[1];
  var s4=useState(null),selP=s4[0],setSelP=s4[1];
  var s5=useState(null),selS=s5[0],setSelS=s5[1];
  var s6=useState("surv"),modalMode=s6[0],setModalMode=s6[1];
  var s7=useState("all"),filter=s7[0],setFilter=s7[1];
  var s8=useState(function(){return ld("ghcfg",{token:"",repo:"",owner:""})}),ghCfg=s8[0],setGhCfg=s8[1];
  var s9=useState(""),syncSt=s9[0],setSyncSt=s9[1];
  var s10=useState(null),toast=s10[0],setToast=s10[1];
  var s11=useState(function(){return ld("dark",false)}),dark=s11[0],setDark=s11[1];
  var s12=useState(""),search=s12[0],setSearch=s12[1];

  useEffect(function(){sv("observations",observations)},[observations]);
  useEffect(function(){sv("treatments",treatments)},[treatments]);
  useEffect(function(){sv("ghcfg",ghCfg)},[ghCfg]);
  useEffect(function(){sv("dark",dark);document.body.classList.toggle("dark",dark)},[dark]);

  function t(m,tp){setToast({m:m,tp:tp||"ok"});setTimeout(function(){setToast(null)},3000)}

  var getObsP=function(sk,pid){return observations.filter(function(r){return r.sk===sk&&r.pid===pid})};
  var getObsPS=function(sk,pid){var r=getObsP(sk,pid);if(!r.length)return"clean";var a=r.filter(function(x){return!x.res});if(a.some(function(x){return x.sev==="Grave"}))return"grave";if(a.some(function(x){return x.sev==="Moyen"}))return"moyen";if(a.some(function(x){return x.sev==="Faible"}))return"faible";return"resolved"};
  var getObsAC=function(sk,pid){return getObsP(sk,pid).filter(function(r){return!r.res}).length};
  var getTrtP=function(sk,pid){return treatments.filter(function(r){return r.sk===sk&&r.pid===pid})};

  function addObs(r){setObs(function(p){return[Object.assign({},r,{id:gid(),by:"user",at:new Date().toISOString()})].concat(p)});t("Observation âœ“")}
  function delObs(id){setObs(function(p){return p.filter(function(r){return r.id!==id})});t("SupprimÃ©")}
  function togObs(id){setObs(function(p){return p.map(function(r){return r.id===id?Object.assign({},r,{res:!r.res,resAt:!r.res?new Date().toISOString():null}):r})})}
  function addTrt(r){setTrt(function(p){return[Object.assign({},r,{id:gid(),by:"user",at:new Date().toISOString()})].concat(p)});t("Traitement âœ“")}
  function delTrt(id){setTrt(function(p){return p.filter(function(r){return r.id!==id})});t("SupprimÃ©")}
  function openModal(sk,p,mode){setSelS(sk);setSelP(p);setModalMode(mode)}

  var bg=dark?"#0F172A":"#F1F5F9",cbg=dark?"#1E293B":"#fff",ctx=dark?"#E2E8F0":"#1E293B",stx=dark?"#94A3B8":"#64748B",bd=dark?"#334155":"#E2E8F0";
  var th={bg:bg,cbg:cbg,ctx:ctx,stx:stx,bd:bd,dark:dark};

  return <div style={{minHeight:"100vh",background:bg,color:ctx,paddingBottom:70}}>
    {toast&&<div style={{position:"fixed",top:16,left:"50%",transform:"translateX(-50%)",zIndex:9999,padding:"12px 24px",borderRadius:14,background:toast.tp==="err"?"#EF4444":"#10B981",color:"#fff",fontWeight:600,fontSize:14,boxShadow:"0 12px 40px rgba(0,0,0,0.3)",animation:"slideDown 0.3s"}}>{toast.m}</div>}

    <header style={{background:"linear-gradient(135deg,#0F172A,#1E293B)",padding:"16px 20px",display:"flex",alignItems:"center",justifyContent:"space-between"}}>
      <div style={{display:"flex",alignItems:"center",gap:10}}>
        <div style={{width:36,height:36,borderRadius:10,background:"linear-gradient(135deg,#10B981,#059669)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18}}>ğŸŒ¿</div>
        <div><h1 style={{color:"#fff",fontSize:17,fontWeight:800,margin:0}}>AGRO BERRY</h1><p style={{color:"#94A3B8",fontSize:10,margin:0}}>Phytosanitaire â€¢ Ferme Zaouia</p></div>
      </div>
      <button onClick={function(){setDark(!dark)}} style={{background:"rgba(255,255,255,0.08)",border:"none",color:"#fff",padding:8,borderRadius:10,fontSize:16,cursor:"pointer",width:36,height:36}}>{dark?"â˜€ï¸":"ğŸŒ™"}</button>
    </header>

    <main style={{padding:"12px 14px",maxWidth:800,margin:"0 auto"}}>
      {page==="dash"&&<Dashboard {...th} observations={observations} treatments={treatments} onOpenParcel={openModal} delObs={delObs} delTrt={delTrt} togObs={togObs}/>}
      {page==="surv"&&<SurvMap {...th} observations={observations} treatments={treatments} getPS={getObsPS} getAC={getObsAC} onSelect={function(sk,p){openModal(sk,p,"surv")}} search={search} setSearch={setSearch} filter={filter} setFilter={setFilter}/>}
      {page==="trt"&&<TrtMap {...th} observations={observations} treatments={treatments} onSelect={function(sk,p){openModal(sk,p,"trt")}} search={search} setSearch={setSearch} filter={filter} setFilter={setFilter}/>}
      {page==="plan"&&<VisualPlan {...th}/>}
      {page==="settings"&&<Settings {...th} ghCfg={ghCfg} setGhCfg={setGhCfg} sync={function(){if(!ghCfg.token||!ghCfg.repo||!ghCfg.owner){t("Config GitHub","err");return}setSyncSt("s");ghSync(ghCfg,{observations:observations,treatments:treatments,at:new Date().toISOString(),v:VER}).then(function(r){if(r.ok){setSyncSt("d");t("SynchronisÃ© âœ“")}else{setSyncSt("e");t("Erreur","err")}}).catch(function(e){setSyncSt("e");t("Erreur","err")}).finally(function(){setTimeout(function(){setSyncSt("")},3000)})}} restore={function(){if(!ghCfg.token||!ghCfg.repo||!ghCfg.owner){t("Config GitHub","err");return}setSyncSt("s");ghRestore(ghCfg).then(function(d){if(d){if(d.observations)setObs(d.observations);if(d.treatments)setTrt(d.treatments);setSyncSt("d");t("RestaurÃ© âœ“")}else{setSyncSt("e");t("Rien trouvÃ©","err")}}).catch(function(){setSyncSt("e");t("Erreur","err")}).finally(function(){setTimeout(function(){setSyncSt("")},3000)})}} syncSt={syncSt} observations={observations} treatments={treatments} setObs={setObs} setTrt={setTrt} t={t}/>}
    </main>

    <nav className="glass" style={{position:"fixed",bottom:0,left:0,right:0,display:"flex",justifyContent:"space-around",padding:"6px 0 8px",borderTop:"1px solid "+(dark?"#1E293B":"#E2E8F0"),zIndex:100}}>
      {[{k:"dash",l:"Dashboard",i:"ğŸ“Š",c:"#10B981"},{k:"surv",l:"Surveillance",i:"ğŸ”",c:"#F59E0B"},{k:"trt",l:"Traitement",i:"ğŸ’Š",c:"#8B5CF6"},{k:"plan",l:"Plan",i:"ğŸ—ï¸",c:"#2563EB"},{k:"settings",l:"Config",i:"âš™ï¸",c:"#64748B"}].map(function(tab){
        return <button key={tab.k} onClick={function(){setPage(tab.k)}} style={{background:"transparent",border:"none",display:"flex",flexDirection:"column",alignItems:"center",gap:2,padding:"4px 8px",cursor:"pointer",color:page===tab.k?tab.c:stx,fontWeight:page===tab.k?700:500,position:"relative"}}>
          {page===tab.k&&<div style={{position:"absolute",top:-6,width:24,height:3,borderRadius:2,background:tab.c}}/>}
          <span style={{fontSize:18}}>{tab.i}</span>
          <span style={{fontSize:9}}>{tab.l}</span>
        </button>
      })}
    </nav>

    {selP&&selS&&<ParcelModal {...th} sec={SECTIONS[selS]} sk={selS} par={selP} mode={modalMode} observations={getObsP(selS,selP.id)} treatments={getTrtP(selS,selP.id)} onClose={function(){setSelP(null);setSelS(null)}} onAddObs={addObs} onDelObs={delObs} onTogObs={togObs} onAddTrt={addTrt} onDelTrt={delTrt} setMode={setModalMode}/>}
  </div>
}

// ===== DASHBOARD =====
function Dashboard({bg,cbg,ctx,stx,bd,dark,observations,treatments,onOpenParcel,delObs,delTrt,togObs}){
  var s1=useState("surv"),dashTab=s1[0],setDashTab=s1[1];
  var ao=observations.filter(function(r){return!r.res});
  var grave=ao.filter(function(r){return r.sev==="Grave"});
  var untreated=ao.filter(function(o){return!treatments.some(function(t){return t.obsId===o.id})});
  var todayObs=observations.filter(function(r){return isToday(r.at)});
  var weekObs=observations.filter(function(r){return isThisWeek(r.at)});
  var pendingDAR=treatments.filter(function(t){return t.darEnd&&new Date(t.darEnd)>new Date()});
  var todayTrt=treatments.filter(function(r){return isToday(r.at)});
  var recentTrt=treatments.filter(function(r){return isThisWeek(r.at)});
  var recentObsList=todayObs.length>0?todayObs:weekObs.slice(0,8);
  var recentTrtList=todayTrt.length>0?todayTrt:recentTrt.slice(0,8);

  var secSummary=Object.entries(SECTIONS).map(function(entry){var sk=entry[0],sec=entry[1];var obs=observations.filter(function(r){return r.sk===sk&&!r.res});return{sk:sk,sec:sec,total:obs.length,g:obs.filter(function(r){return r.sev==="Grave"}).length,m:obs.filter(function(r){return r.sev==="Moyen"}).length,f:obs.filter(function(r){return r.sev==="Faible"}).length,tc:treatments.filter(function(t){return t.sk===sk}).length}}).filter(function(s){return s.total>0||s.tc>0}).sort(function(a,b){return b.g-a.g||b.total-a.total});

  function openP(r,mode){var sec=SECTIONS[r.sk];if(!sec)return;var p=sec.parcelles.find(function(p){return p.id===r.pid});if(p)onOpenParcel(r.sk,p,mode)}

  return <div>
    <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8,marginBottom:14}}>
      {[{i:"âš ï¸",v:ao.length,l:"Actifs",c:"#EAB308",b:dark?"#1C1917":"#FFFBEB"},{i:"ğŸ”´",v:grave.length,l:"Graves",c:"#EF4444",b:dark?"#1C1017":"#FEF2F2"},{i:"ğŸš¨",v:untreated.length,l:"Non traitÃ©s",c:"#EA580C",b:dark?"#1C1510":"#FFF7ED"},{i:"ğŸ’Š",v:treatments.length,l:"Traitements",c:"#8B5CF6",b:dark?"#1A1028":"#F5F3FF"}].map(function(c,i){
        return <div key={i} style={{background:c.b,borderRadius:14,padding:"12px 8px",textAlign:"center",border:"1px solid "+bd}}>
          <div style={{fontSize:16}}>{c.i}</div><div style={{fontSize:22,fontWeight:800,color:c.c,marginTop:2}}>{c.v}</div><div style={{fontSize:9,color:c.c,fontWeight:600}}>{c.l}</div>
        </div>
      })}
    </div>

    <div style={{display:"flex",gap:8,marginBottom:14,background:dark?"#1E293B":"#E2E8F0",borderRadius:14,padding:4}}>
      <button onClick={function(){setDashTab("surv")}} style={{flex:1,padding:10,borderRadius:11,border:"none",background:dashTab==="surv"?cbg:"transparent",color:dashTab==="surv"?"#F59E0B":stx,fontWeight:dashTab==="surv"?700:500,fontSize:13,cursor:"pointer",boxShadow:dashTab==="surv"?"0 2px 8px rgba(0,0,0,0.08)":"none"}}>ğŸ” Surveillance</button>
      <button onClick={function(){setDashTab("trt")}} style={{flex:1,padding:10,borderRadius:11,border:"none",background:dashTab==="trt"?cbg:"transparent",color:dashTab==="trt"?"#8B5CF6":stx,fontWeight:dashTab==="trt"?700:500,fontSize:13,cursor:"pointer",boxShadow:dashTab==="trt"?"0 2px 8px rgba(0,0,0,0.08)":"none"}}>ğŸ’Š Traitement</button>
    </div>

    {dashTab==="surv"&&<div style={{animation:"fadeIn 0.3s"}}>
      {grave.length>0&&<div className="card" style={{background:dark?"#2A1015":"#FEF2F2",border:"1px solid "+(dark?"#5C2020":"#FECACA"),marginBottom:12,padding:14}}>
        <div style={{fontSize:13,fontWeight:700,color:"#DC2626",marginBottom:10,display:"flex",alignItems:"center",gap:6}}><span className="pulse" style={{width:10,height:10,borderRadius:"50%",background:"#EF4444",display:"inline-block"}}/>{grave.length+" cas GRAVE"+(grave.length>1?"S":"")}</div>
        {grave.slice(0,5).map(function(r){var sec=SECTIONS[r.sk];return <div key={r.id} onClick={function(){openP(r,"surv")}} style={{padding:10,marginBottom:6,background:cbg,borderRadius:12,cursor:"pointer",border:"1px solid "+bd}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}>
            <div><span style={{fontWeight:700,fontSize:12,color:sec?sec.color:"#888"}}>{(sec?sec.name:"")+" â€” "+r.pid}</span><span className="tag" style={{background:"#FECACA",color:"#991B1B",marginLeft:6}}>Grave</span></div>
            <div style={{display:"flex",alignItems:"center",gap:4}}><span style={{fontSize:9,color:stx}}>{timeAgo(r.at)}</span><button className="del-btn" onClick={function(e){e.stopPropagation();if(confirm("Supprimer ?"))delObs(r.id)}}>ğŸ—‘ï¸</button></div>
          </div>
          <div style={{fontSize:13,fontWeight:600}}>{r.dis}</div>
          {r.zone&&<span style={{fontSize:10,color:stx}}>{" â€¢ "+r.zone+"% touchÃ©"}</span>}
          {r.obsText&&<div style={{fontSize:11,color:stx,marginTop:3,fontStyle:"italic"}}>{r.obsText}</div>}
          <PhotoGrid photos={(r.photos||[]).slice(0,3)} dark={dark}/>
        </div>})}
      </div>}

      {untreated.length>0&&<div className="card" style={{background:dark?"#1C1510":"#FFF7ED",border:"1px solid "+(dark?"#5C3A10":"#FDBA74"),marginBottom:12,padding:14}}>
        <div style={{fontSize:13,fontWeight:700,color:"#EA580C",marginBottom:8}}>{"âš ï¸ "+untreated.length+" cas en attente de traitement"}</div>
        {untreated.slice(0,5).map(function(r){var sec=SECTIONS[r.sk];var sevS=SC[r.sev]||{};return <div key={r.id} onClick={function(){openP(r,"trt")}} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",marginBottom:4,background:cbg,borderRadius:10,cursor:"pointer",border:"1px solid "+bd}}>
          <div><span style={{fontWeight:700,fontSize:11,color:sec?sec.color:"#888"}}>{(sec?sec.name:"")+" â€” "+r.pid}</span><span style={{fontSize:11,marginLeft:6}}>{r.dis}</span></div>
          <div style={{display:"flex",alignItems:"center",gap:4}}><span className="tag" style={{background:sevS.bg,color:sevS.text}}>{r.sev}</span><button className="del-btn" onClick={function(e){e.stopPropagation();if(confirm("Supprimer ?"))delObs(r.id)}}>ğŸ—‘ï¸</button></div>
        </div>})}
      </div>}

      {secSummary.filter(function(s){return s.total>0}).length>0&&<div style={{marginBottom:14}}>
        <h3 style={{fontSize:14,fontWeight:700,marginBottom:8}}>ğŸ“Š Par section</h3>
        {secSummary.filter(function(s){return s.total>0}).map(function(s){return <div key={s.sk} className="card" style={{background:cbg,padding:"10px 12px",marginBottom:6,border:"1px solid "+bd,borderLeft:"4px solid "+s.sec.color,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
          <div><span style={{fontWeight:700,fontSize:13,color:s.sec.color}}>{s.sec.name}</span><span style={{fontSize:10,color:stx,marginLeft:6}}>{s.sec.area}</span></div>
          <div style={{display:"flex",gap:3}}>{s.g>0&&<span className="tag" style={{background:"#FEE2E2",color:"#991B1B"}}>{s.g+"ğŸ”´"}</span>}{s.m>0&&<span className="tag" style={{background:"#FED7AA",color:"#9A3412"}}>{s.m+"ğŸŸ "}</span>}{s.f>0&&<span className="tag" style={{background:"#FEF9C3",color:"#854D0E"}}>{s.f+"ğŸŸ¡"}</span>}</div>
        </div>})}
      </div>}

      <h3 style={{fontSize:14,fontWeight:700,marginBottom:8}}>{todayObs.length>0?"ğŸ“‹ Aujourd'hui ("+todayObs.length+")":"ğŸ“‹ Cette semaine"}</h3>
      {recentObsList.length===0?<div style={{textAlign:"center",padding:40,background:cbg,borderRadius:16,border:"1px solid "+bd}}><div style={{fontSize:40}}>âœ…</div><p style={{fontWeight:600,color:stx,marginTop:8}}>Aucune observation rÃ©cente</p></div>:
      recentObsList.map(function(r){var sec=SECTIONS[r.sk];var lt=treatments.filter(function(t){return t.obsId===r.id});var sevS=SC[r.sev]||{};return <div key={r.id} className="card" style={{background:cbg,border:"1px solid "+bd,borderLeft:"4px solid "+(sec?sec.color:"#888"),padding:14,marginBottom:8}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:6}}>
          <div><span style={{fontWeight:700,fontSize:11,color:sec?sec.color:"#888"}}>{(sec?sec.name:"")+" â€” "+r.pid}</span><span className="tag" style={{background:sevS.bg,color:sevS.text,marginLeft:6}}>{r.sev}</span>{r.res&&<span className="tag" style={{background:"#DCFCE7",color:"#166534",marginLeft:4}}>âœ“</span>}</div>
          <div style={{display:"flex",alignItems:"center",gap:4}}><span style={{fontSize:9,color:stx}}>{timeAgo(r.at)}</span><button className="del-btn" onClick={function(){togObs(r.id)}}>{r.res?"â†©ï¸":"âœ…"}</button><button className="del-btn" onClick={function(){if(confirm("Supprimer ?"))delObs(r.id)}}>ğŸ—‘ï¸</button></div>
        </div>
        <div style={{fontSize:14,fontWeight:600,marginBottom:2}}>{r.dis}</div>
        <div style={{display:"flex",gap:10,fontSize:11,color:stx}}><span>{"ğŸ“… "+fD(r.date)+" "+fH(r.at)}</span>{r.zone&&<span>{"ğŸ“ "+r.zone+"%"}</span>}</div>
        {r.obsText&&<div style={{fontSize:12,marginTop:4,padding:"6px 10px",background:dark?"#0F172A":"#F8FAFC",borderRadius:8,borderLeft:"3px solid "+(sec?sec.color:"#888")}}>{"ğŸ“ "+r.obsText}</div>}
        <PhotoGrid photos={r.photos||[]} dark={dark}/>
        {lt.length>0&&<div style={{marginTop:8,padding:"8px 10px",background:dark?"#1A1028":"#F5F3FF",borderRadius:10}}><div style={{fontSize:10,fontWeight:700,color:"#7C3AED"}}>{"ğŸ’Š "+lt.length+" traitement"+(lt.length>1?"s":"")}</div>{lt.map(function(t){return <div key={t.id} style={{fontSize:11,color:stx}}>{t.prod+" â€” "+t.dose}</div>})}</div>}
      </div>})}
    </div>}

    {dashTab==="trt"&&<div style={{animation:"fadeIn 0.3s"}}>
      {pendingDAR.length>0&&<div className="card" style={{background:dark?"#1A1028":"#F5F3FF",border:"1px solid "+(dark?"#2D1F5E":"#DDD6FE"),marginBottom:12,padding:14}}>
        <div style={{fontSize:13,fontWeight:700,color:"#7C3AED",marginBottom:8}}>{"â³ "+pendingDAR.length+" DAR actif"+(pendingDAR.length>1?"s":"")}</div>
        {pendingDAR.map(function(t){var sec=SECTIONS[t.sk];var dj=Math.ceil((new Date(t.darEnd)-new Date())/864e5);return <div key={t.id} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",marginBottom:4,background:cbg,borderRadius:10,border:"1px solid "+bd}}>
          <div><span style={{fontWeight:700,fontSize:11,color:sec?sec.color:"#888"}}>{(sec?sec.name:"")+" â€” "+t.pid}</span><span style={{fontSize:11,color:stx,marginLeft:6}}>{t.prod}</span></div>
          <div style={{display:"flex",alignItems:"center",gap:4}}><span className="tag blink" style={{background:"#FFF7ED",color:"#C2410C"}}>{dj+"j"}</span><button className="del-btn" onClick={function(){if(confirm("Supprimer ?"))delTrt(t.id)}}>ğŸ—‘ï¸</button></div>
        </div>})}
      </div>}

      <h3 style={{fontSize:14,fontWeight:700,marginBottom:8}}>{todayTrt.length>0?"ğŸ’Š Aujourd'hui ("+todayTrt.length+")":"ğŸ’Š Cette semaine"}</h3>
      {recentTrtList.length===0?<div style={{textAlign:"center",padding:40,background:cbg,borderRadius:16,border:"1px solid "+bd}}><div style={{fontSize:40}}>ğŸ’Š</div><p style={{fontWeight:600,color:stx,marginTop:8}}>Aucun traitement rÃ©cent</p></div>:
      recentTrtList.map(function(r){var sec=SECTIONS[r.sk];var lo=observations.find(function(o){return o.id===r.obsId});var da=r.darEnd&&new Date(r.darEnd)>new Date();var dd=da?Math.ceil((new Date(r.darEnd)-new Date())/864e5):0;return <div key={r.id} className="card" style={{background:cbg,border:"1px solid "+bd,borderLeft:"4px solid "+(da?"#F97316":"#8B5CF6"),padding:14,marginBottom:8}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:4}}>
          <div><span style={{fontWeight:700,fontSize:11,color:sec?sec.color:"#888"}}>{(sec?sec.name:"")+" â€” "+r.pid}</span>{da&&<span className="tag blink" style={{background:"#FFF7ED",color:"#C2410C",marginLeft:6}}>{"â³ "+dd+"j"}</span>}</div>
          <div style={{display:"flex",alignItems:"center",gap:4}}><span style={{fontSize:9,color:stx}}>{timeAgo(r.at)}</span><button className="del-btn" onClick={function(){if(confirm("Supprimer ?"))delTrt(r.id)}}>ğŸ—‘ï¸</button></div>
        </div>
        <div style={{fontSize:14,fontWeight:700,color:dark?"#C4B5FD":"#6D28D9"}}>{r.prod}</div>
        <div style={{fontSize:12,color:stx}}>{"ğŸ“ "+r.dose+" â€¢ ğŸ“… "+fD(r.tdate)}</div>
        {r.dar&&<div style={{fontSize:11,color:"#EA580C",marginTop:2}}>{"â³ DAR "+r.dar+"j â†’ fin "+fD(r.darEnd)}</div>}
        {lo&&<div style={{marginTop:6,padding:"6px 8px",background:dark?"#1C1917":"#FEF9C3",borderRadius:8,fontSize:10,fontWeight:600,color:"#92400E"}}>{"ğŸ”— "+lo.dis+" ("+lo.sev+")"}</div>}
      </div>})}

      {secSummary.filter(function(s){return s.tc>0}).length>0&&<div style={{marginTop:6}}>
        <h3 style={{fontSize:14,fontWeight:700,marginBottom:8}}>ğŸ“Š Traitements par section</h3>
        {secSummary.filter(function(s){return s.tc>0}).map(function(s){return <div key={s.sk} className="card" style={{background:cbg,padding:"10px 12px",marginBottom:6,border:"1px solid "+bd,borderLeft:"4px solid "+s.sec.color,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
          <div><span style={{fontWeight:700,color:s.sec.color}}>{s.sec.name}</span><span style={{fontSize:10,color:stx,marginLeft:6}}>{s.sec.area}</span></div>
          <span className="tag" style={{background:"#EDE9FE",color:"#6D28D9"}}>{s.tc+" ğŸ’Š"}</span>
        </div>})}
      </div>}
    </div>}
  </div>
}

// ===== SURVEILLANCE MAP =====
function SurvMap({bg,cbg,ctx,stx,bd,dark,observations,treatments,getPS,getAC,onSelect,search,setSearch,filter,setFilter}){
  var s1=useState(null),exp=s1[0],setExp=s1[1];
  var ao=observations.filter(function(r){return!r.res});var gt=ao.filter(function(r){return r.sev==="Grave"}).length;
  var totalP=Object.values(SECTIONS).reduce(function(s,sec){return s+sec.parcelles.length},0);
  var groups=[{title:"ğŸ« Myrtille HLS",keys:["AG1","AG2","AG3a","AG3b"],type:"hls"},{title:"ğŸ« Myrtille Sol",keys:["AG4","AG5","AG6"],type:"sol"},{title:"ğŸ“ Fraise",keys:["S1","S2","S3"],type:"fraise"}];
  var fGroups=filter==="all"?groups:groups.filter(function(g){return g.type===filter});
  function getSS(key){var sec=SECTIONS[key];var a=0,g=0;sec.parcelles.forEach(function(p){var r=observations.filter(function(r){return r.sk===key&&r.pid===p.id&&!r.res});a+=r.length;g+=r.filter(function(r){return r.sev==="Grave"}).length});return{a:a,g:g}}

  return <div>
    <div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:8,marginBottom:12}}>
      {[{l:"Parcelles",v:totalP,i:"ğŸŒ±",c:"#10B981",b:dark?"#0D2818":"#ECFDF5"},{l:"Actifs",v:ao.length,i:"âš ï¸",c:"#EAB308",b:dark?"#1C1917":"#FFFBEB"},{l:"Graves",v:gt,i:"ğŸ”´",c:"#EF4444",b:dark?"#1C1017":"#FEF2F2"}].map(function(c,i){return <div key={i} style={{background:c.b,borderRadius:14,padding:"10px 8px",textAlign:"center",border:"1px solid "+bd}}><div style={{fontSize:16}}>{c.i}</div><div style={{fontSize:22,fontWeight:800,color:c.c}}>{c.v}</div><div style={{fontSize:9,color:c.c,fontWeight:600}}>{c.l}</div></div>})}
    </div>
    <div style={{display:"flex",gap:6,marginBottom:10}}>
      {[{k:"all",l:"Tout"},{k:"hls",l:"HLS"},{k:"sol",l:"Sol"},{k:"fraise",l:"Fraise"}].map(function(f){return <button key={f.k} onClick={function(){setFilter(f.k)}} className={"btn "+(filter===f.k?"btn-primary":"btn-ghost")} style={{padding:"7px 14px",fontSize:11}}>{f.l}</button>})}
    </div>
    {fGroups.map(function(grp,gi){return <div key={gi} style={{marginBottom:14}}>
      <h3 style={{fontSize:13,fontWeight:700,marginBottom:8}}>{grp.title}</h3>
      <div style={{display:"grid",gridTemplateColumns:"repeat(2,1fr)",gap:8}}>
        {grp.keys.map(function(key){var sec=SECTIONS[key];var ss=getSS(key);var isExp=exp===key;
          return <div key={key} style={{gridColumn:isExp?"1/-1":"auto"}}>
            <div onClick={function(){setExp(isExp?null:key)}} className="card" style={{background:cbg,border:"1.5px solid "+(isExp?sec.color+"66":bd),cursor:"pointer"}}>
              <div style={{background:"linear-gradient(135deg,"+sec.color+","+sec.color+"CC)",padding:"10px 12px",display:"flex",justifyContent:"space-between"}}><span style={{color:"#fff",fontWeight:700,fontSize:14}}>{sec.name+" ("+sec.label+")"}</span><span style={{color:"rgba(255,255,255,0.8)",fontSize:10}}>{sec.area}</span></div>
              <div style={{padding:"8px 12px",display:"flex",justifyContent:"space-between"}}><span style={{fontSize:10,color:stx}}>{sec.parcelles.length+" parc."}</span><div style={{display:"flex",gap:4}}>{ss.a>0&&<span className="tag" style={{background:"#FEF9C3",color:"#854D0E"}}>{ss.a}</span>}{ss.g>0&&<span className="tag blink" style={{background:"#FEE2E2",color:"#991B1B"}}>{ss.g+"ğŸ”´"}</span>}{ss.a===0&&<span className="tag" style={{background:"#DCFCE7",color:"#166534"}}>âœ“</span>}</div></div>
            </div>
            {isExp&&<div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:6,marginTop:8,animation:"fadeIn 0.2s"}}>
              {sec.parcelles.map(function(p){var st=getPS(key,p.id);var ac=getAC(key,p.id);return <div key={p.id} onClick={function(e){e.stopPropagation();onSelect(key,p)}} className={st==="grave"?"blink":""} style={{background:dark?(st==="grave"?"#2A1015":"#1E293B"):stBg[st],border:"2px solid "+stBdr[st],borderRadius:12,padding:"10px 6px",textAlign:"center",cursor:"pointer",position:"relative"}}>
                {ac>0&&<div style={{position:"absolute",top:-5,right:-5,background:"#EF4444",color:"#fff",fontSize:8,fontWeight:800,width:18,height:18,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",border:"2px solid "+cbg}}>{ac}</div>}
                <div style={{display:"flex",justifyContent:"center",alignItems:"center",gap:4}}><span style={{width:8,height:8,borderRadius:"50%",background:stClr[st]||stClr.clean,display:"inline-block"}}/><span style={{fontWeight:700,fontSize:13}}>{p.id}</span></div>
                <div style={{fontSize:9,color:stx,marginTop:2}}>{p.area}</div>
              </div>})}
            </div>}
          </div>
        })}
      </div>
    </div>})}
  </div>
}

// ===== TRAITEMENT MAP =====
function TrtMap({bg,cbg,ctx,stx,bd,dark,observations,treatments,onSelect,search,setSearch,filter,setFilter}){
  var s1=useState(null),exp=s1[0],setExp=s1[1];
  var groups=[{title:"ğŸ« Myrtille HLS",keys:["AG1","AG2","AG3a","AG3b"],type:"hls"},{title:"ğŸ« Myrtille Sol",keys:["AG4","AG5","AG6"],type:"sol"},{title:"ğŸ“ Fraise",keys:["S1","S2","S3"],type:"fraise"}];
  var fGroups=filter==="all"?groups:groups.filter(function(g){return g.type===filter});
  return <div>
    <div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:8,marginBottom:12}}>
      {[{l:"Total",v:treatments.length,i:"ğŸ’Š",c:"#8B5CF6",b:dark?"#1A1028":"#F5F3FF"},{l:"Non traitÃ©s",v:observations.filter(function(o){return!o.res&&!treatments.some(function(t){return t.obsId===o.id})}).length,i:"âš ï¸",c:"#EF4444",b:dark?"#1C1017":"#FEF2F2"},{l:"DAR actif",v:treatments.filter(function(t){return t.darEnd&&new Date(t.darEnd)>new Date()}).length,i:"â³",c:"#EA580C",b:dark?"#1C1510":"#FFF7ED"}].map(function(c,i){return <div key={i} style={{background:c.b,borderRadius:14,padding:"10px 8px",textAlign:"center",border:"1px solid "+bd}}><div style={{fontSize:16}}>{c.i}</div><div style={{fontSize:22,fontWeight:800,color:c.c}}>{c.v}</div><div style={{fontSize:9,color:c.c,fontWeight:600}}>{c.l}</div></div>})}
    </div>
    <div style={{display:"flex",gap:6,marginBottom:10}}>
      {[{k:"all",l:"Tout"},{k:"hls",l:"HLS"},{k:"sol",l:"Sol"},{k:"fraise",l:"Fraise"}].map(function(f){return <button key={f.k} onClick={function(){setFilter(f.k)}} className={"btn "+(filter===f.k?"btn-trt":"btn-ghost")} style={{padding:"7px 14px",fontSize:11}}>{f.l}</button>})}
    </div>
    {fGroups.map(function(grp,gi){return <div key={gi} style={{marginBottom:14}}>
      <h3 style={{fontSize:13,fontWeight:700,marginBottom:8}}>{grp.title}</h3>
      <div style={{display:"grid",gridTemplateColumns:"repeat(2,1fr)",gap:8}}>
        {grp.keys.map(function(key){var sec=SECTIONS[key];var tc=treatments.filter(function(t){return t.sk===key}).length;var isExp=exp===key;
          return <div key={key} style={{gridColumn:isExp?"1/-1":"auto"}}>
            <div onClick={function(){setExp(isExp?null:key)}} className="card" style={{background:cbg,border:"1.5px solid "+(isExp?sec.color+"66":bd),cursor:"pointer"}}>
              <div style={{background:"linear-gradient(135deg,"+sec.color+","+sec.color+"CC)",padding:"10px 12px",display:"flex",justifyContent:"space-between"}}><span style={{color:"#fff",fontWeight:700,fontSize:14}}>{sec.name}</span><span style={{color:"rgba(255,255,255,0.8)",fontSize:10}}>{sec.area}</span></div>
              <div style={{padding:"8px 12px",display:"flex",justifyContent:"space-between"}}><span style={{fontSize:10,color:stx}}>{sec.parcelles.length+" parc."}</span>{tc>0&&<span className="tag" style={{background:"#EDE9FE",color:"#6D28D9"}}>{tc+" ğŸ’Š"}</span>}</div>
            </div>
            {isExp&&<div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:6,marginTop:8,animation:"fadeIn 0.2s"}}>
              {sec.parcelles.map(function(p){var ptc=treatments.filter(function(t){return t.sk===key&&t.pid===p.id}).length;var hasDAR=treatments.some(function(t){return t.sk===key&&t.pid===p.id&&t.darEnd&&new Date(t.darEnd)>new Date()});return <div key={p.id} onClick={function(e){e.stopPropagation();onSelect(key,p)}} className={hasDAR?"blink":""} style={{background:cbg,border:"2px solid "+(hasDAR?"#FB923C":ptc?"#93C5FD":bd),borderRadius:12,padding:"10px 6px",textAlign:"center",cursor:"pointer",position:"relative"}}>
                {ptc>0&&<div style={{position:"absolute",top:-5,right:-5,background:"#8B5CF6",color:"#fff",fontSize:8,fontWeight:800,width:18,height:18,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",border:"2px solid "+cbg}}>{ptc}</div>}
                <span style={{fontWeight:700,fontSize:13}}>{p.id}</span><div style={{fontSize:9,color:stx,marginTop:2}}>{p.area}</div>
              </div>})}
            </div>}
          </div>
        })}
      </div>
    </div>})}
  </div>
}

// ===== PARCEL MODAL =====
function ParcelModal({sec,sk,par,mode,observations,treatments,onClose,onAddObs,onDelObs,onTogObs,onAddTrt,onDelTrt,setMode,dark,cbg,ctx,stx,bd}){
  var s1=useState("list"),tab=s1[0],setTab=s1[1];
  var diseases=sec.type==="fraise"?DIS_F:DIS_M;
  var activeObs=observations.filter(function(r){return!r.res});
  var color=mode==="surv"?"#D97706":"#7C3AED";
  var gradient=mode==="surv"?"linear-gradient(135deg,#F59E0B,#D97706)":"linear-gradient(135deg,#8B5CF6,#7C3AED)";

  return <div style={{position:"fixed",inset:0,zIndex:1000,animation:"fadeIn 0.2s"}}>
    <div onClick={onClose} style={{position:"absolute",inset:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(6px)"}}/>
    <div style={{position:"absolute",bottom:0,left:0,right:0,maxHeight:"92vh",background:cbg,borderRadius:"24px 24px 0 0",overflow:"hidden",animation:"slideUp 0.3s",display:"flex",flexDirection:"column"}}>
      <div style={{background:gradient,padding:"16px 20px",flexShrink:0}}>
        <div style={{display:"flex",justifyContent:"space-between"}}>
          <div><h2 style={{color:"#fff",fontSize:20,fontWeight:800,margin:0}}>{(mode==="surv"?"ğŸ” ":"ğŸ’Š ")+sec.name+" â€” "+par.id}</h2><p style={{color:"rgba(255,255,255,0.8)",fontSize:12,margin:"2px 0 0"}}>{sec.fullName+" â€¢ "+par.area}</p></div>
          <button onClick={onClose} style={{background:"rgba(255,255,255,0.15)",border:"none",color:"#fff",width:32,height:32,borderRadius:10,fontSize:16,cursor:"pointer"}}>âœ•</button>
        </div>
        <div style={{display:"flex",gap:6,marginTop:10}}>
          <span className="tag" style={{background:"rgba(255,255,255,0.2)",color:"#fff"}}>{activeObs.length+" actif"+(activeObs.length>1?"s":"")}</span>
          <span className="tag" style={{background:"rgba(255,255,255,0.2)",color:"#fff"}}>{treatments.length+" trt"}</span>
          <button onClick={function(){setMode(mode==="surv"?"trt":"surv");setTab("list")}} className="btn" style={{marginLeft:"auto",background:"rgba(255,255,255,0.2)",color:"#fff",padding:"4px 12px",fontSize:10}}>{mode==="surv"?"ğŸ’Š Traitement â†’":"ğŸ” Surveillance â†’"}</button>
        </div>
      </div>
      <div style={{display:"flex",borderBottom:"1px solid "+bd,flexShrink:0}}>
        {(mode==="surv"?[{k:"list",l:"Observations"},{k:"add",l:"â• Observer"}]:[{k:"list",l:"Traitements"},{k:"add",l:"â• Traiter"}]).map(function(t){return <button key={t.k} onClick={function(){setTab(t.k)}} style={{flex:1,padding:"12px 8px",border:"none",borderBottom:tab===t.k?"3px solid "+color:"3px solid transparent",background:"transparent",color:tab===t.k?color:stx,fontWeight:tab===t.k?700:500,fontSize:12,cursor:"pointer"}}>{t.l}</button>})}
      </div>
      <div style={{flex:1,overflow:"auto",padding:16}}>
        {mode==="surv"&&tab==="list"&&(observations.length===0?<div style={{textAlign:"center",padding:40,color:stx}}><div style={{fontSize:48}}>âœ…</div><p style={{fontWeight:600,marginTop:8}}>Parcelle saine</p></div>:
        <div style={{display:"flex",flexDirection:"column",gap:10}}>{observations.map(function(r){var lt=treatments.filter(function(t){return t.obsId===r.id});var sevS=SC[r.sev]||{};return <div key={r.id} className="card" style={{background:r.res?(dark?"#1E293B":"#F8FAFC"):(sevS.bg||cbg),border:"1px solid "+(r.res?bd:sevS.border||bd),padding:14,opacity:r.res?0.6:1}}>
          <div style={{display:"flex",justifyContent:"space-between",marginBottom:6}}><div><span style={{fontWeight:700,fontSize:14}}>{r.dis}</span><span className="tag" style={{background:sevS.bg,color:sevS.text,marginLeft:6}}>{r.sev}</span>{r.res&&<span className="tag" style={{background:"#DCFCE7",color:"#166534",marginLeft:4}}>âœ“</span>}</div><span style={{fontSize:9,color:stx}}>{timeAgo(r.at)}</span></div>
          <div style={{fontSize:11,color:stx}}>{"ğŸ“… "+fD(r.date)+" "+fH(r.at)}{r.zone&&" â€¢ ğŸ“ "+r.zone+"%"}</div>
          {r.obsText&&<div style={{fontSize:12,marginTop:6,padding:"8px 10px",background:dark?"#0F172A":"#F8FAFC",borderRadius:10,borderLeft:"3px solid "+color}}>{r.obsText}</div>}
          <PhotoGrid photos={r.photos||[]} dark={dark}/>
          {lt.length>0&&<div style={{marginTop:8,padding:8,background:dark?"#1A1028":"#F5F3FF",borderRadius:10}}><div style={{fontSize:10,fontWeight:700,color:"#7C3AED"}}>{"ğŸ’Š "+lt.length+" trt"}</div>{lt.map(function(t){return <div key={t.id} style={{fontSize:11,color:stx}}>{t.prod+" "+t.dose}</div>})}</div>}
          <div style={{display:"flex",gap:6,marginTop:10}}><button onClick={function(){onTogObs(r.id)}} className={"btn "+(r.res?"btn-surv":"btn-primary")} style={{flex:1,padding:8,fontSize:11,justifyContent:"center"}}>{r.res?"â†©ï¸ RÃ©activer":"âœ… RÃ©solu"}</button><button onClick={function(){if(confirm("Supprimer ?"))onDelObs(r.id)}} className="btn btn-danger" style={{padding:"8px 12px",fontSize:11}}>ğŸ—‘ï¸</button></div>
        </div>})}</div>)}

        {mode==="surv"&&tab==="add"&&<AddObsForm sk={sk} pid={par.id} diseases={diseases} onSubmit={onAddObs} dark={dark} cbg={cbg} ctx={ctx} stx={stx} bd={bd}/>}

        {mode==="trt"&&tab==="list"&&(treatments.length===0?<div style={{textAlign:"center",padding:40,color:stx}}><div style={{fontSize:48}}>ğŸ’Š</div><p style={{fontWeight:600,marginTop:8}}>Aucun traitement</p></div>:
        <div style={{display:"flex",flexDirection:"column",gap:10}}>{treatments.map(function(r){var lo=observations.find(function(o){return o.id===r.obsId});var da=r.darEnd&&new Date(r.darEnd)>new Date();var dd=da?Math.ceil((new Date(r.darEnd)-new Date())/864e5):0;return <div key={r.id} className="card" style={{background:dark?"#1A1028":"#F5F3FF",border:"1px solid "+(dark?"#2D1F5E":"#DDD6FE"),padding:14,borderLeft:"4px solid "+(da?"#F97316":"#8B5CF6")}}>
          <div style={{display:"flex",justifyContent:"space-between",marginBottom:4}}><span style={{fontWeight:700,fontSize:15,color:dark?"#C4B5FD":"#6D28D9"}}>{r.prod}</span><div style={{display:"flex",alignItems:"center",gap:4}}>{da&&<span className="tag blink" style={{background:"#FFF7ED",color:"#C2410C"}}>{"â³"+dd+"j"}</span>}<span style={{fontSize:9,color:stx}}>{timeAgo(r.at)}</span></div></div>
          <div style={{fontSize:12,color:stx}}>{"ğŸ“ "+r.dose+" â€¢ ğŸ“… "+fD(r.tdate)}</div>
          {r.dar&&<div style={{fontSize:11,color:"#EA580C",marginTop:2}}>{"DAR "+r.dar+"j â†’ fin "+fD(r.darEnd)}</div>}
          {r.notes&&<div style={{fontSize:11,color:stx,fontStyle:"italic",marginTop:2}}>{r.notes}</div>}
          {lo&&<div style={{marginTop:6,padding:"6px 8px",background:dark?"#1C1917":"#FEF9C3",borderRadius:8,fontSize:10,fontWeight:600,color:"#92400E"}}>{"ğŸ”— "+lo.dis+" ("+lo.sev+")"}</div>}
          <div style={{marginTop:10}}><button onClick={function(){if(confirm("Supprimer ?"))onDelTrt(r.id)}} className="btn btn-danger" style={{padding:"8px 12px",fontSize:11}}>ğŸ—‘ï¸ Supprimer</button></div>
        </div>})}</div>)}

        {mode==="trt"&&tab==="add"&&<AddTrtForm sk={sk} pid={par.id} activeObs={activeObs} onSubmit={onAddTrt} dark={dark} cbg={cbg} ctx={ctx} stx={stx} bd={bd}/>}
      </div>
    </div>
  </div>
}

function AddObsForm({sk,pid,diseases,onSubmit,dark,cbg,ctx,stx,bd}){
  var s1=useState(""),dis=s1[0],setDis=s1[1];var s2=useState(""),cust=s2[0],setCust=s2[1];var s3=useState(""),sev=s3[0],setSev=s3[1];
  var s4=useState(new Date().toISOString().split("T")[0]),date=s4[0],setDate=s4[1];var s5=useState(""),obsText=s5[0],setObsText=s5[1];
  var s6=useState(""),zone=s6[0],setZone=s6[1];var s7=useState([]),photos=s7[0],setPhotos=s7[1];
  var is={width:"100%",padding:"12px 14px",borderRadius:12,border:"1.5px solid "+bd,fontSize:14,outline:"none",background:dark?"#0F172A":cbg,color:ctx};
  function go(){var d=dis==="__c"?cust:dis;if(!d||!sev){alert("Maladie et gravitÃ© requis");return}onSubmit({sk:sk,pid:pid,dis:d,sev:sev,date:date,obsText:obsText,zone:zone,photos:photos,res:false});setDis("");setCust("");setSev("");setObsText("");setZone("");setPhotos([])}
  return <div style={{display:"flex",flexDirection:"column",gap:14}}>
    <div><label style={{display:"block",fontSize:12,fontWeight:600,color:stx,marginBottom:5}}>ğŸ¦  Maladie *</label><select value={dis} onChange={function(e){setDis(e.target.value)}} style={Object.assign({},is,{cursor:"pointer"})}><option value="">SÃ©lectionner...</option>{diseases.map(function(d){return <option key={d} value={d}>{d}</option>})}<option value="__c">âœï¸ Autre</option></select>{dis==="__c"&&<input value={cust} onChange={function(e){setCust(e.target.value)}} placeholder="Nom..." style={Object.assign({},is,{marginTop:6})}/>}</div>
    <div><label style={{display:"block",fontSize:12,fontWeight:600,color:stx,marginBottom:5}}>âš ï¸ GravitÃ© *</label><div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:8}}>{["Faible","Moyen","Grave"].map(function(s){return <button key={s} onClick={function(){setSev(s)}} className="btn" style={{padding:"12px 8px",borderRadius:12,border:"2px solid "+(sev===s?SC[s].border:bd),background:sev===s?SC[s].bg:(dark?"#1E293B":cbg),color:sev===s?SC[s].text:stx,fontWeight:700,justifyContent:"center"}}>{SC[s].icon+" "+s}</button>})}</div></div>
    <div><label style={{display:"block",fontSize:12,fontWeight:600,color:stx,marginBottom:5}}>ğŸ“… Date</label><input type="date" value={date} onChange={function(e){setDate(e.target.value)}} style={is}/></div>
    <div><label style={{display:"block",fontSize:12,fontWeight:600,color:stx,marginBottom:5}}>ğŸ“ Zone touchÃ©e (%)</label><input type="number" value={zone} onChange={function(e){setZone(e.target.value)}} placeholder="30" min={0} max={100} style={is}/></div>
    <div><label style={{display:"block",fontSize:12,fontWeight:600,color:stx,marginBottom:5}}>ğŸ“ Observation</label><textarea value={obsText} onChange={function(e){setObsText(e.target.value)}} placeholder="SymptÃ´mes observÃ©s..." rows={3} style={Object.assign({},is,{resize:"vertical"})}/></div>
    <div><label style={{display:"block",fontSize:12,fontWeight:600,color:stx,marginBottom:5}}>ğŸ“· Photos</label><PhotoCapture photos={photos} setPhotos={setPhotos} dark={dark} bd={bd}/></div>
    <button onClick={go} className="btn btn-surv" style={{width:"100%",padding:14,fontSize:15,justifyContent:"center",borderRadius:14}}>ğŸ” Enregistrer</button>
  </div>
}

function AddTrtForm({sk,pid,activeObs,onSubmit,dark,cbg,ctx,stx,bd}){
  var s1=useState(""),obsId=s1[0],setObsId=s1[1];var s2=useState(""),prod=s2[0],setProd=s2[1];var s3=useState(""),dose=s3[0],setDose=s3[1];
  var s4=useState(new Date().toISOString().split("T")[0]),tdate=s4[0],setTdate=s4[1];var s5=useState(""),dar=s5[0],setDar=s5[1];var s6=useState(""),notes=s6[0],setNotes=s6[1];
  var darEnd=dar&&tdate?new Date(new Date(tdate).getTime()+parseInt(dar)*864e5).toISOString().split("T")[0]:"";
  var is={width:"100%",padding:"12px 14px",borderRadius:12,border:"1.5px solid "+bd,fontSize:14,outline:"none",background:dark?"#0F172A":cbg,color:ctx};
  function go(){if(!prod||!dose){alert("Produit et dose requis");return}onSubmit({sk:sk,pid:pid,obsId:obsId||null,prod:prod,dose:dose,tdate:tdate,dar:dar,darEnd:darEnd,notes:notes});setProd("");setDose("");setDar("");setNotes("");setObsId("")}
  return <div style={{display:"flex",flexDirection:"column",gap:14}}>
    {activeObs.length>0&&<div><label style={{display:"block",fontSize:12,fontWeight:600,color:stx,marginBottom:5}}>ğŸ”— Lier Ã </label><select value={obsId} onChange={function(e){setObsId(e.target.value)}} style={Object.assign({},is,{cursor:"pointer"})}><option value="">PrÃ©ventif</option>{activeObs.map(function(o){return <option key={o.id} value={o.id}>{o.dis+" ("+o.sev+")"}</option>})}</select></div>}
    <div><label style={{display:"block",fontSize:12,fontWeight:600,color:stx,marginBottom:5}}>ğŸ’Š Produit *</label><input value={prod} onChange={function(e){setProd(e.target.value)}} placeholder="Soufre, Switch..." style={is}/></div>
    <div><label style={{display:"block",fontSize:12,fontWeight:600,color:stx,marginBottom:5}}>ğŸ“ Dose *</label><input value={dose} onChange={function(e){setDose(e.target.value)}} placeholder="5 kg/ha..." style={is}/></div>
    <div><label style={{display:"block",fontSize:12,fontWeight:600,color:stx,marginBottom:5}}>ğŸ“… Date</label><input type="date" value={tdate} onChange={function(e){setTdate(e.target.value)}} style={is}/></div>
    <div><label style={{display:"block",fontSize:12,fontWeight:600,color:stx,marginBottom:5}}>â³ DAR (jours)</label><input type="number" value={dar} onChange={function(e){setDar(e.target.value)}} placeholder="7, 14..." min={0} style={is}/>{darEnd&&<div style={{marginTop:6,fontSize:12,color:"#EA580C",fontWeight:600,padding:"8px 12px",background:dark?"#1C1510":"#FFF7ED",borderRadius:10}}>{"âš ï¸ RÃ©colte dÃ¨s "+fD(darEnd)}</div>}</div>
    <div><label style={{display:"block",fontSize:12,fontWeight:600,color:stx,marginBottom:5}}>ğŸ“ Notes</label><textarea value={notes} onChange={function(e){setNotes(e.target.value)}} placeholder="Notes..." rows={2} style={Object.assign({},is,{resize:"vertical"})}/></div>
    <button onClick={go} className="btn btn-trt" style={{width:"100%",padding:14,fontSize:15,justifyContent:"center",borderRadius:14}}>ğŸ’Š Enregistrer</button>
  </div>
}

function VisualPlan({bg,cbg,ctx,stx,bd,dark}){
  var s1=useState(1),zoom=s1[0],setZoom=s1[1];
  var blocks=[{id:"Bureau",x:37,y:0,w:9,h:3.5,c:"#64748B",ic:"ğŸ¢"},{id:"V15\n0.68ha",x:20,y:2,w:6,h:5,c:"#3B82F6",sec:1},{id:"V13\n0.66ha",x:29,y:2,w:6,h:5,c:"#3B82F6",sec:1},{id:"V16\n0.86ha",x:20,y:8,w:7,h:6,c:"#3B82F6",sec:1},{id:"V14\n0.74ha",x:27,y:8,w:7,h:6,c:"#3B82F6",sec:1},{id:"V18\n1.00ha",x:2,y:3,w:8,h:6,c:"#6366F1",sec:1},{id:"V17\n0.91ha",x:2,y:10,w:7,h:6,c:"#6366F1",sec:1},{id:"V1\n0.42ha",x:39,y:7,w:7,h:5.5,c:"#DC2626",sec:1},{id:"V2\n0.31ha",x:46,y:7,w:6,h:5.5,c:"#DC2626",sec:1},{id:"V4\n0.42ha",x:39,y:13.5,w:7,h:5.5,c:"#DC2626",sec:1},{id:"V1\n0.68ha",x:39,y:45,w:7,h:5.5,c:"#16A34A",sec:1},{id:"V2\n0.37ha",x:46,y:45,w:6,h:5.5,c:"#16A34A",sec:1}];
  return <div>
    <h2 style={{fontSize:18,fontWeight:800,marginBottom:10}}>ğŸ—ï¸ Plan Ferme Zaouia</h2>
    <div style={{display:"flex",gap:6,marginBottom:10,justifyContent:"center"}}>
      <button onClick={function(){setZoom(Math.max(0.5,zoom-0.2))}} className="btn btn-ghost" style={{width:36,height:36,padding:0,justifyContent:"center"}}>âˆ’</button>
      <span style={{padding:"8px 12px",fontSize:12,fontWeight:600,color:stx}}>{Math.round(zoom*100)+"%"}</span>
      <button onClick={function(){setZoom(Math.min(3,zoom+0.2))}} className="btn btn-ghost" style={{width:36,height:36,padding:0,justifyContent:"center"}}>+</button>
      <button onClick={function(){setZoom(1)}} className="btn btn-ghost" style={{padding:"8px 12px",fontSize:11}}>Reset</button>
    </div>
    <div style={{overflow:"auto",borderRadius:16,border:"1.5px solid "+bd,background:dark?"#0A1A0D":"#E8F5E9",padding:16,textAlign:"center"}}>
      <p style={{color:stx,fontSize:13}}>Plan interactif â€” Zoom {Math.round(zoom*100)}%</p>
      <p style={{color:stx,fontSize:11,marginTop:8}}>38 ha total â€¢ 10 sections â€¢ HLS + Sol + Fraise</p>
    </div>
  </div>
}

function Settings({bg,cbg,ctx,stx,bd,dark,ghCfg,setGhCfg,sync,restore,syncSt,observations,treatments,setObs,setTrt,t}){
  var is={width:"100%",padding:"12px 14px",borderRadius:12,border:"1.5px solid "+bd,fontSize:14,outline:"none",background:dark?"#0F172A":cbg,color:ctx};
  function exp(){var b=new Blob([JSON.stringify({observations:observations,treatments:treatments,at:new Date().toISOString(),v:VER},null,2)],{type:"application/json"});var a=document.createElement("a");a.href=URL.createObjectURL(b);a.download="agro-berry-"+new Date().toISOString().split("T")[0]+".json";a.click();t("ExportÃ© âœ“")}
  function imp(e){var f=e.target.files[0];if(!f)return;var r=new FileReader();r.onload=function(ev){try{var d=JSON.parse(ev.target.result);if(d.observations){setObs(d.observations);if(d.treatments)setTrt(d.treatments);t("ImportÃ© âœ“")}else t("Invalide","err")}catch(err){t("Erreur","err")}};r.readAsText(f)}
  return <div>
    <h2 style={{fontSize:18,fontWeight:800,marginBottom:14}}>âš™ï¸ ParamÃ¨tres</h2>
    <div className="card" style={{background:cbg,padding:16,marginBottom:12,border:"1px solid "+bd}}>
      <h3 style={{fontSize:15,fontWeight:700,marginBottom:12}}>ğŸ™ GitHub Sync</h3>
      <div style={{display:"flex",flexDirection:"column",gap:10}}>
        <input value={ghCfg.owner} onChange={function(e){setGhCfg(Object.assign({},ghCfg,{owner:e.target.value}))}} placeholder="Username" style={is}/>
        <input value={ghCfg.repo} onChange={function(e){setGhCfg(Object.assign({},ghCfg,{repo:e.target.value}))}} placeholder="Repo" style={is}/>
        <input type="password" value={ghCfg.token} onChange={function(e){setGhCfg(Object.assign({},ghCfg,{token:e.target.value}))}} placeholder="Token ghp_..." style={is}/>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
          <button onClick={sync} disabled={syncSt==="s"} className="btn btn-primary" style={{justifyContent:"center",opacity:syncSt==="s"?0.6:1}}>{syncSt==="s"?"â³":"â˜ï¸ Sauvegarder"}</button>
          <button onClick={restore} disabled={syncSt==="s"} className="btn btn-trt" style={{justifyContent:"center",opacity:syncSt==="s"?0.6:1}}>{syncSt==="s"?"â³":"ğŸ“¥ Restaurer"}</button>
        </div>
      </div>
    </div>
    <div className="card" style={{background:cbg,padding:16,marginBottom:12,border:"1px solid "+bd}}>
      <h3 style={{fontSize:15,fontWeight:700,marginBottom:12}}>ğŸ’¾ DonnÃ©es</h3>
      <div style={{display:"flex",gap:12,marginBottom:12,fontSize:13,color:stx}}><span>{"ğŸ” "+observations.length+" obs"}</span><span>{"ğŸ’Š "+treatments.length+" trt"}</span></div>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
        <button onClick={exp} className="btn btn-ghost" style={{justifyContent:"center"}}>ğŸ“¤ Exporter</button>
        <label className="btn btn-ghost" style={{justifyContent:"center",cursor:"pointer"}}>ğŸ“¥ Importer<input type="file" accept=".json" onChange={imp} style={{display:"none"}}/></label>
      </div>
    </div>
    <div className="card" style={{background:dark?"#1C1017":"#FEF2F2",padding:16,border:"1px solid "+(dark?"#5C2020":"#FECACA")}}>
      <button onClick={function(){if(confirm("SUPPRIMER TOUTES LES DONNÃ‰ES ?")){setObs([]);setTrt([])}}} className="btn btn-danger" style={{width:"100%",justifyContent:"center"}}>ğŸ—‘ï¸ Tout supprimer</button>
    </div>
    <p style={{textAlign:"center",fontSize:11,color:stx,marginTop:16,fontWeight:500}}>{"Agro Berry v"+VER+" â€¢ Ferme Zaouia"}</p>
  </div>
}

ReactDOM.render(<App/>, document.getElementById("root"));
</script>
</body>
</html>
